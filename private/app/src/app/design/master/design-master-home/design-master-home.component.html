<div id="grid-container">
    <section id="navigation">
        <app-navigation></app-navigation>
    </section>
    <section id="selection">
        <app-tile>
            <div tile-header>
                All Master Data
            </div>
            <div tile-content>
                Select to edit
            </div>
        </app-tile>
        <mat-card>
            <mat-card-header>
                <mat-card-title>All Master Data</mat-card-title>
                <mat-card-subtitle>Select to edit</mat-card-subtitle>
            </mat-card-header>
        </mat-card>
        <mat-nav-list class="scrollable">
            <mat-list-item (click)="selectMasterData('__select_master_data_overview')">Master Data Overview</mat-list-item>
            @for (masterDataElement of dbMasterDataOverviewData; track masterDataElement._id) {
                @if (masterDataElement.display_name) {
                    <mat-list-item (click)="selectMasterData(masterDataElement._id)">{{ masterDataElement.display_name }}</mat-list-item>
                } 
                @else {
                    <mat-list-item (click)="selectMasterData(masterDataElement._id)">{{ masterDataElement._id }}</mat-list-item>
                }
            }
        </mat-nav-list>
    </section>
    <section id="activity">
        <ng-container [ngSwitch]="selectedMasterDataId">

            <ng-container *ngSwitchCase="'__select_master_data_overview'">
                <ng-container *ngTemplateOutlet="masterDataOverviewTable"></ng-container>
            </ng-container>
            <ng-container *ngSwitchCase="'__add_new_master_data_type'">
                <app-design-master-add-new 
                    (apiResponse)="handleApiResponse($event)"
                    (tableDataEmitter)="handleTableDataResponse($event)"
                ></app-design-master-add-new>
            </ng-container>
            <!-- Specific Master Data Type selected -->
            <ng-container *ngSwitchDefault> 
                <app-design-master-edit 
                (apiResponse)="handleApiResponse($event)" 
                (tableDataEmitter)="handleTableDataResponse($event)"
                [masterDataId]="selectedMasterDataId"
            ></app-design-master-edit>

            </ng-container>
        </ng-container>
    </section>
    <section id="preview">
        <ng-container [ngSwitch]="selectedMasterDataId">
            <ng-container *ngSwitchCase="'__select_master_data_overview'">
                <ng-container *ngTemplateOutlet="selectMasterDataPlaceholder"></ng-container>
            </ng-container>
            <ng-container *ngSwitchCase="'__add_new_master_data_type'">
                <app-table [tableData]="previewTableData"></app-table>
            </ng-container>
            <ng-container *ngSwitchDefault> 
                <ng-container *ngIf="selectedMasterDataObject; then masterDataPreviewTable">
                </ng-container>
            </ng-container>
        </ng-container>

    </section>
    <!-- <button (click)="addNotification('This is an success message')">Add Error</button> -->

  </div>

<!-- NOTE: The following code should not be placed inside *ngIf="sidebarOpen" because if so, 
it will be newly created on toggle and the transition will not happen -->
<div [class.sidebar-open]="isSidebarOpen" class="sidebar">
    sidebar content
</div>
<div class="sidebar-overlay" [class.sidebar-open-overlay]="isSidebarOpen" (click)="toggleSidebar()"></div>
<app-notification [notifications]="notifications" [dismissalTime]="dismissalTime" (notificationDismissed)="onNotificaitonDismissed($event)"></app-notification>

<ng-template #masterDataOverviewTable>
    <mat-card class="activity-flex-item">
        <mat-card-header>
            <mat-card-title>Master Data Overview</mat-card-title>
            <mat-card-subtitle>This is an overview of all Master Data. Click to edit</mat-card-subtitle>
        </mat-card-header>
    </mat-card>
    <div class="activity-flex-item horizontal-bar">
        <form class="bar-element">
            <input type="text" placeholder="Search..." (keyup)="applyFilter($event)" #input/>
        </form>
        <div class="bar-element activity-flex-item">
            <button mat-button (click)="selectMasterData('__add_new_master_data_type')">
                Add New
                <mat-icon>add</mat-icon>
            </button>
        </div>
    </div>
    <div class="activity-flex-item scrollable">
        <table mat-table [dataSource]="filteredMasterDataOverviewData">
            <ng-container matColumnDef="_id">
                <th mat-header-cell *matHeaderCellDef> ID </th>
                <td mat-cell *matCellDef="let element"> {{element._id}} </td>
            </ng-container>
            <ng-container matColumnDef="display_name">
                <th mat-header-cell *matHeaderCellDef> Name </th>
                <td mat-cell *matCellDef="let element"> {{element.display_name}} </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="masterDataOverviewColumnsToDisplay"></tr>
            <tr mat-row *matRowDef="let myRowData; columns: masterDataOverviewColumnsToDisplay"></tr>

            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
            </tr>
        </table>
    </div>
    <div class="activity-flex-item stick-to-section-bottom">
        <button>hi NY!</button>
    </div>
</ng-template>


<ng-template #masterDataPreviewTable>
    @if (selectedMasterDataObject) {
        @if (selectedMasterDataObject.display_name) {
            {{ selectedMasterDataObject.display_name }}

        } 
        @else {
            {{ selectedMasterDataObject._id }}
        }
    }
    <app-table [tableData]="previewTableData"></app-table>
</ng-template>

<ng-template #selectMasterDataPlaceholder>
    <p>Please Select Master Data</p>
</ng-template>